const { api } = require('./config');
const request = require('request');

module.exports = {
  uploadKeyEncrypt: async (encryptKey, opts, metadata) => {
    return new Promise((resolve) => {
      request(
        {
          method: 'PUT',
          url: `${opts.endpoint}${api.uploadKeyEncrypt}`,
          headers: {
            'x-api-project-key': opts.bucketKey,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            projectId: metadata.projectId.toString(),
            filePath: metadata.filePath,
            encryptKey,
            signData: opts.signData,
          }),
        },
        function(e, res) {
          if (e) throw new Error(`error upload key encrypt to eueno : ${e}`);
          resolve(JSON.parse(res.body));
        },
      );
    });
  },
};
