const request = require('request');
const { api } = require('./config');
const { signLogin } = require('./sign');

module.exports = {
  shareTo: async (opts) => {
    if (!opts.signData) {
      opts.signData = await signLogin(opts.projectKey);
    }
    return new Promise((resolve) => {
      request(
        {
          method: 'POST',
          url: `${opts.endpoint}${api.shareTo}`,
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            'projectId': opts.projectId.toString(),
            'fileId': opts.fileId.toString(),
            'sharedUserAddress': opts.addressShare,
            'encryptedKey': opts.encryptedKeyShare,
            'signData': opts.signData,
          }),
        },
        function(error, response) {
          if (error) throw new Error(error);
          resolve(JSON.parse(response.body));
        },
      );
    });
  },
};
